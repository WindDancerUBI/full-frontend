---
sidebar_position: 4
tags: 
  - Three
---

# å››ã€æè´¨ä¸çº¹ç†

## 4.1 åŠ è½½çº¹ç†

çº¹ç†æ˜¯åŠ è½½åˆ°æè´¨ä¸Šçš„ï¼Œæè´¨æœ‰å¾ˆå¤šä¸­ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åŸºç¡€æè´¨ï¼Œç”±three.jsæä¾›MeshBasicMaterialæ„é€ æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„å‚æ•°mapå¯ä»¥æ¥å—çº¹ç†å›¾ç‰‡ã€‚

åŠ è½½çº¹ç†å›¾ç‰‡ç”±TextureLoaderè¿™ä¸ªæ–¹æ³•æ¥å®ç°ã€‚æˆ‘ä»¬åªéœ€é€šè¿‡newä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å®ä¾‹å¯¹è±¡çš„loadæ–¹æ³•å³å¯åŠ è½½å›¾ç‰‡ã€‚

TextureLoaderæ„é€ æ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°loadingManagerï¼Œè¯¥å‚æ•°ç±»å‹æ˜¯LoadingManagerã€‚å¯ä»¥è‡ªè¡Œå®šä¹‰onStartã€onProgressã€onLoadã€onErrorç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¼šåœ¨æ‰€æœ‰èµ„æºå¼€å§‹åŠ è½½ã€åŠ è½½ä¸­ã€åŠ è½½å®Œæ¯•ã€åŠ è½½å¤±è´¥æ—¶è¿›è¡Œæ¯æ‰ã€‚

åŠ è½½çº¹ç†çš„ç›¸å…³ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```tsx
const Chapter4_1 = () => {
  const ref = useRef<HTMLDivElement>(null);
  const size = useSize(ref);
  const [loadTip, setLoadTip] = useState<string>("");

  const initThree = () => {
    /** --- åˆ›å»ºä¸€ä¸ªåœºæ™¯ --- */
    scene = new THREE.Scene();

    /** --- åˆ›å»ºä¸€ä¸ªç½‘æ ¼æ¨¡å‹ --- */
    // åˆ›å»ºä¸€ä¸ªå‡ ä½•ä½“
    const geometry = new THREE.BoxGeometry();

    const loadingManager = new THREE.LoadingManager();
    loadingManager.onStart = (url, itemsLoaded, itemsTotal) => {
      setLoadTip(
        `å¼€å§‹åŠ è½½èµ„æº: ${url}.\nLoaded ${itemsLoaded} of ${itemsTotal} files.`
      );
    };
    loadingManager.onProgress = (url, itemsLoaded, itemsTotal) => {
      setLoadTip(
        `åŠ è½½èµ„æºä¸­: ${url}.\nLoaded ${itemsLoaded} of ${itemsTotal} files.`
      );
    };
    loadingManager.onLoad = () => {
      setLoadTip("åŠ è½½èµ„æºå®Œæˆ");
    };
    loadingManager.onError = (url) => {
      setLoadTip(`åŠ è½½èµ„æºå‡ºé”™ ${url}`);
    };

    const textureLoader = new THREE.TextureLoader(loadingManager);
    const colorTexture = textureLoader.load("/textures/door/color.jpg");
    const alphaTexture = textureLoader.load("/textures/door/alpha.jpg");
    const heightTexture = textureLoader.load("/textures/door/height.jpg");
    const normalTexture = textureLoader.load("/textures/door/normal.jpg");
    /** -- åŠ è½½ä¼—å¤šèµ„æº --- */

    // åˆ›å»ºä¸€ä¸ªæè´¨å¯¹è±¡
    const material = new THREE.MeshBasicMaterial({ map: colorTexture });
    // åˆ›å»ºä¸€ä¸ªç½‘æ ¼æ¨¡å‹å¯¹è±¡
    const mesh = new THREE.Mesh(geometry, material);
    // å°†ç½‘æ ¼æ¨¡å‹å¯¹è±¡æ·»åŠ åˆ°åœºæ™¯ä¸­
    scene.add(mesh);

		/** --- other codes --- */

    render();
  };
 
	/** --- other codes --- */

  return (
    <div id="container" style={{ width: "100%", height: "100%" }} ref={ref}>
      <div className="load-tip" id="tip">{loadTip}</div>
    </div>
  );
};

export default Chapter4_1;
```

## 4.2 çº¹ç†å˜æ¢

å¯ä»¥åƒä¹‹å‰ç»™meshè®¾ç½®å„ç§å˜æ¢ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™çº¹ç†è®¾ç½®å˜æ¢å±æ€§ï¼ŒåŒ…æ‹¬é‡å¤ã€åç§»ã€æ—‹è½¬ç­‰ã€‚

åœ¨è®¾ç½®é‡å¤å±æ€§æ—¶ï¼Œä¸ä»…éœ€è¦è®¾ç½®xå’Œyè½´é‡å¤çš„æ¬¡æ•°ï¼Œè¿˜éœ€è¦æŒ‡å®šåŒ…è£¹æ¨¡å¼ã€‚å¦‚æœåªè®¾ç½®é‡å¤æ¬¡æ•°å±æ€§ï¼Œé‚£ä¹ˆä¼šçœ‹åˆ°å¹¶æ²¡æœ‰ repeatï¼Œè€Œæ˜¯è¾¹ç¼˜çš„åƒç´ è¢«æ‹‰ä¼¸äº†ã€‚

å…¶ä¸­ `wrapS` è¿™ä¸ªå€¼å®šä¹‰äº†çº¹ç†è´´å›¾åœ¨æ°´å¹³æ–¹å‘ä¸Šå°†å¦‚ä½•åŒ…è£¹ï¼Œåœ¨ UV æ˜ å°„ä¸­å¯¹åº”äº Uã€‚`wrapT` è¿™ä¸ªå€¼å®šä¹‰äº†çº¹ç†è´´å›¾åœ¨å‚ç›´æ–¹å‘ä¸Šå°†å¦‚ä½•åŒ…è£¹ï¼Œåœ¨ UV æ˜ å°„ä¸­å¯¹åº”äº Vã€‚
é»˜è®¤å€¼æ˜¯ `THREE.ClampToEdgeWrapping`ï¼Œå³çº¹ç†è¾¹ç¼˜å°†è¢«æ¨åˆ°å¤–éƒ¨è¾¹ç¼˜çš„çº¹ç´ ã€‚ å…¶å®ƒçš„ä¸¤ä¸ªé€‰é¡¹åˆ†åˆ«æ˜¯ `THREE.RepeatWrapping` å’Œ `THREE.MirroredRepeatWrapping`ã€‚

- `ClampToEdgeWrapping` æ˜¯é»˜è®¤å€¼ï¼Œçº¹ç†ä¸­çš„æœ€åä¸€ä¸ªåƒç´ å°†å»¶ä¼¸åˆ°ç½‘æ ¼çš„è¾¹ç¼˜
- `RepeatWrapping`ï¼Œçº¹ç†å°†ç®€å•åœ°é‡å¤åˆ°æ— ç©·å¤§ã€‚
- `MirroredRepeatWrapping`ï¼Œ çº¹ç†å°†é‡å¤åˆ°æ— ç©·å¤§ï¼Œåœ¨æ¯æ¬¡é‡å¤æ—¶å°†è¿›è¡Œé•œåƒã€‚

åç§»åªéœ€è¦åœ¨xå’Œyè½´çš„åç§»é‡ï¼Œå³å¯è¾¾åˆ°åç§»çš„æ•ˆæœã€‚æ—‹è½¬éœ€è¦è®¾ç½®æ—‹è½¬çš„è§’åº¦ï¼Œè¿˜å¯ä»¥è®¾ç½®æ—‹è½¬ä¸­å¿ƒã€‚ç›¸å…³ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```tsx
const initThree = () => {
  /** --- åˆ›å»ºä¸€ä¸ªåœºæ™¯ --- */
  scene = new THREE.Scene();

  /** --- åˆ›å»ºä¸€ä¸ªç½‘æ ¼æ¨¡å‹ --- */
  // åˆ›å»ºä¸€ä¸ªå‡ ä½•ä½“
  const geometry = new THREE.BoxGeometry();

  const loadingManager = new THREE.LoadingManager();
  loadingManager.onStart = (url, itemsLoaded, itemsTotal) => {
    setLoadTip(
      `å¼€å§‹åŠ è½½èµ„æº: ${url}.\nLoaded ${itemsLoaded} of ${itemsTotal} files.`
    );
  };
  loadingManager.onProgress = (url, itemsLoaded, itemsTotal) => {
    setLoadTip(
      `åŠ è½½èµ„æºä¸­: ${url}.\nLoaded ${itemsLoaded} of ${itemsTotal} files.`
    );
  };
  loadingManager.onLoad = () => {
    setLoadTip("åŠ è½½èµ„æºå®Œæˆ");
  };
  loadingManager.onError = (url) => {
    setLoadTip(`åŠ è½½èµ„æºå‡ºé”™ ${url}`);
  };

  const textureLoader = new THREE.TextureLoader(loadingManager);
  const colorTexture = textureLoader.load("/textures/door/color.jpg");

  // çº¹ç†å˜æ¢
  colorTexture.repeat.x = 2;
  colorTexture.repeat.x = 3;
  // ä»¥ä¸Šä¸¤ä¸ªè®¾ç½®å¹¶æ²¡æœ‰repeatï¼Œè€Œæ˜¯è¾¹ç¼˜çš„åƒç´ è¢«æ‹‰ä¼¸äº†ï¼Œéœ€è¦å†è®¾ç½®å±æ€§wrapSå’ŒwrapT
  colorTexture.wrapS = THREE.RepeatWrapping;
  colorTexture.wrapT = THREE.RepeatWrapping;
  // colorTexture.wrapS = THREE.MirroredRepeatWrapping;
  // colorTexture.wrapT = THREE.MirroredRepeatWrapping;
  // è®¾ç½®åç§»å±æ€§
  colorTexture.offset.x = 0.5
  colorTexture.offset.y = 0
  // è®¾ç½®æ—‹è½¬å±æ€§
  colorTexture.rotation = Math.PI / 4
  colorTexture.center = new Vector2(0.5, 0.5)

  // åˆ›å»ºä¸€ä¸ªæè´¨å¯¹è±¡
  const material = new THREE.MeshBasicMaterial({ map: colorTexture });
  // åˆ›å»ºä¸€ä¸ªç½‘æ ¼æ¨¡å‹å¯¹è±¡
  const mesh = new THREE.Mesh(geometry, material);
  // å°†ç½‘æ ¼æ¨¡å‹å¯¹è±¡æ·»åŠ åˆ°åœºæ™¯ä¸­
  scene.add(mesh);

  /** --- other codes --- */

  render();
};
```

## 4.3 çº¹ç†æ˜¾ç¤ºç®—æ³•ä¸mipmap

å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œçº¹ç†ä½¿ç”¨çš„å›¾ç‰‡å¤§å°ä¸ç‰©ä½“çš„å°ºå¯¸å¤§å°æ˜¯ä¸ä¸€è‡´çš„ã€‚é‚£ä¹ˆä¸€ä¸ªå°ºå¯¸å¾ˆå°çš„å›¾ç‰‡ä½œä¸ºçº¹ç†ç”¨åœ¨ç‰©ä½“ä¸Šä¼šæ˜¯ä»€ä¹ˆæ ·çš„æ•ˆæœå‘¢ï¼Ÿ

æˆ‘ä»¬æ¥ä¸‹æ¥ä½¿ç”¨`/textures/minecraft.png` è¿™ä¸ªè·¯å¾„ä¸‹çš„å›¾ç‰‡ä½œä¸ºçº¹ç†ã€‚å®ƒæ˜¯ä¸€ä¸ªå°ºå¯¸éå¸¸å°çš„å›¾ç‰‡ï¼Œå°†å…¶æ”¾å¤§åå¯ä»¥çœ‹å‡ºå®ƒå¤§æ¦‚æ˜¯é•¿è¿™æ ·çš„ã€‚

![1.png](./img/1.png)

ç„¶åæˆ‘ä»¬å°†å®ƒä½œä¸ºçº¹ç†ï¼Œè¿è¡Œç¨‹åºåï¼Œå±‚ç°åœ¨æˆ‘ä»¬çœ¼å‰çš„ç‰©ä½“æ˜¯è¿™ä¸ªæ ·å­çš„ã€‚

![2.png](./img/2.png)

æ˜¾ç„¶ï¼Œå®é™…å±‚ç°å‡ºæ¥çš„ç‰©ä½“çº¹ç†çœ‹èµ·æ¥å¾ˆæ¨¡ç³Šã€‚è¿™æ˜¯å› ä¸ºç‰©ä½“çš„å°ºå¯¸ã€åˆ†è¾¨ç‡å’Œå›¾ç‰‡çš„å°ºå¯¸ã€åˆ†è¾¨ç‡æ˜¯ä¸åŒçš„ã€‚three.jsä½¿ç”¨Filtering and Mipmappingå¯¹å›¾ç‰‡è¿›è¡Œäº†å¤„ç†ã€‚

<aside>
ğŸ’¡ åœ¨ä¸‰ç»´è®¡ç®—æœºå›¾å½¢çš„è´´å›¾æ¸²æŸ“ä¸­æœ‰ä¸€ä¸ªå¸¸ç”¨çš„æŠ€æœ¯è¢«ç§°ä¸º Mipmappingã€‚ä¸ºäº†åŠ å¿«æ¸²æŸ“é€Ÿåº¦å’Œå‡å°‘å›¾åƒé”¯é½¿ï¼Œè´´å›¾è¢«å¤„ç†æˆç”±ä¸€ç³»åˆ—è¢«é¢„å…ˆè®¡ç®—å’Œä¼˜åŒ–è¿‡çš„å›¾ç‰‡ç»„æˆçš„æ–‡ä»¶, è¿™æ ·çš„è´´å›¾è¢«ç§°ä¸º MIP map æˆ–è€… mipmapã€‚è¿™ä¸ªæŠ€æœ¯åœ¨ä¸‰ç»´æ¸¸æˆä¸­è¢«éå¸¸å¹¿æ³›çš„ä½¿ç”¨ã€‚

</aside>

Filtering and Mipmappingæœ‰**Magnification filterï¼ˆæ”¾å¤§æ»¤é•œï¼‰**å’Œ**Minification filterï¼ˆç¼©å°æ»¤é•œï¼‰ã€‚**

è¿™ä¸¤ä¸ªå±æ€§çš„æšä¸¾å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š

- THREE.NearestFilter
- THREE.NearestMipmapNearestFilter
- THREE.NearestMipmapLinearFilter
- THREE.LinearFilter
- THREE.LinearMipmapNearestFilter
- THREE.LinearMipmapLinearFilter

é»˜è®¤å€¼æ˜¯LinearMipmapNearestFilterï¼Œå®ƒé€‰æ‹©ä¸è¢«çº¹ç†åŒ–åƒç´ çš„å°ºå¯¸æœ€æ¥è¿‘çš„ä¸¤ä¸ªmipmapï¼Œ å¹¶ä»¥LinearFilterä¸ºæ ‡å‡†æ¥ä»æ¯ä¸ªmipmapä¸­ç”Ÿæˆçº¹ç†å€¼ã€‚æœ€ç»ˆçš„çº¹ç†å€¼æ˜¯è¿™ä¸¤ä¸ªå€¼çš„åŠ æƒå¹³å‡å€¼ã€‚å› æ­¤å®ƒå±‚ç°å‡ºçš„çº¹ç†é¢œè‰²å˜åŒ–æ²¡æœ‰åŸå›¾é‚£ä¹ˆçªå…€ï¼Œå› æ­¤çœ‹èµ·æ¥ä¹Ÿæ¯”åŸå›¾æ¨¡ç³Šã€‚

è€ŒTHREE.NearestFilter è¿”å›ä¸æŒ‡å®šçº¹ç†åæ ‡ï¼ˆåœ¨æ›¼å“ˆé¡¿è·ç¦»ä¹‹å†…ï¼‰æœ€æ¥è¿‘çš„çº¹ç†å…ƒç´ ã€‚ç°åœ¨æˆ‘ä»¬å°†è¯¥çº¹ç†å›¾ç‰‡çš„æ”¾å¤§æ»¤é•œè®¾ç½®ä¸ºNearestFilterã€‚ç›¸å…³çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```tsx
const initThree = () => {
  /** --- åˆ›å»ºä¸€ä¸ªåœºæ™¯ --- */
  scene = new THREE.Scene();

  /** --- åˆ›å»ºä¸€ä¸ªç½‘æ ¼æ¨¡å‹ --- */
  // åˆ›å»ºä¸€ä¸ªå‡ ä½•ä½“
  const geometry = new THREE.BoxGeometry();

  const loadingManager = new THREE.LoadingManager();
  loadingManager.onStart = (url, itemsLoaded, itemsTotal) => {
    setLoadTip(
      `å¼€å§‹åŠ è½½èµ„æº: ${url}.\nLoaded ${itemsLoaded} of ${itemsTotal} files.`
    );
  };
  loadingManager.onProgress = (url, itemsLoaded, itemsTotal) => {
    setLoadTip(
      `åŠ è½½èµ„æºä¸­: ${url}.\nLoaded ${itemsLoaded} of ${itemsTotal} files.`
    );
  };
  loadingManager.onLoad = () => {
    setLoadTip("åŠ è½½èµ„æºå®Œæˆ");
  };
  loadingManager.onError = (url) => {
    setLoadTip(`åŠ è½½èµ„æºå‡ºé”™ ${url}`);
  };

  const textureLoader = new THREE.TextureLoader(loadingManager);
  const texture = textureLoader.load("/textures/minecraft.png");

  texture.minFilter = THREE.NearestFilter;
  texture.magFilter = THREE.NearestFilter;

  // åˆ›å»ºä¸€ä¸ªæè´¨å¯¹è±¡
  const material = new THREE.MeshBasicMaterial({ map: texture });
  // åˆ›å»ºä¸€ä¸ªç½‘æ ¼æ¨¡å‹å¯¹è±¡
  const mesh = new THREE.Mesh(geometry, material);
  // å°†ç½‘æ ¼æ¨¡å‹å¯¹è±¡æ·»åŠ åˆ°åœºæ™¯ä¸­
  scene.add(mesh);

	/** --- other codes --- */

  render();
};
```

æœ€ç»ˆå±•ç¤ºçš„çº¹ç†å›¾åƒå¦‚ä¸‹æ‰€ç¤ºï¼Œæ¯”èµ·ä¹‹å‰çš„å›¾åƒæ›´åŠ çš„æ¸…æ™°é”åˆ©ï¼Œè¿™æ­£æ˜¯æ”¾å¤§æ»¤é•œå¯¹å›¾ç‰‡çš„å¤„ç†ã€‚

![3.png](./img/3.png)

## 4.4 åŸºç¡€æè´¨å‚æ•°

åŸºç¡€ç½‘æ ¼æè´¨æ˜¯ä¸€ä¸ªä»¥ç®€å•ç€è‰²ï¼ˆå¹³é¢æˆ–çº¿æ¡†ï¼‰æ–¹å¼æ¥ç»˜åˆ¶å‡ ä½•ä½“çš„æè´¨ã€‚è¿™ç§æè´¨ä¸å—å…‰ç…§çš„å½±å“ã€‚

### 4.4.1 **wireframe**

å°†å‡ ä½•ä½“æ¸²æŸ“ä¸ºçº¿æ¡†ã€‚é»˜è®¤å€¼ä¸º**false**ï¼ˆå³æ¸²æŸ“ä¸ºå¹³é¢å¤šè¾¹å½¢ï¼‰ã€‚

åœ¨æœ¬èŠ‚ä½¿ç”¨çš„å‡ ä½•ä½“ä¸ºæ­£æ–¹ä½“ã€‚å®ƒçš„æ¯ä¸€ä¸ªé¢æ˜¯ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œè€Œä¸€ä¸ªæ­£æ–¹å½¢æ˜¯ç”±ä¸¤ä¸ªä¸‰è§’å½¢æ‹¼æ¥è€Œæˆçš„ã€‚å› æ­¤å®ƒçš„çº¿æ¡†æ¸²æŸ“ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![4.png](./img/4.png)

### 4.4.2 é€æ˜åº¦ä¸é€æ˜åº¦è´´å›¾

`transparent`å®šä¹‰æ­¤æè´¨æ˜¯å¦é€æ˜ã€‚è¿™å¯¹æ¸²æŸ“æœ‰å½±å“ï¼Œå› ä¸ºé€æ˜å¯¹è±¡éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¹¶åœ¨éé€æ˜å¯¹è±¡ä¹‹åæ¸²æŸ“ã€‚ è®¾ç½®ä¸ºtrueæ—¶ï¼Œé€šè¿‡è®¾ç½®æè´¨çš„opacityå±æ€§æ¥æ§åˆ¶æè´¨é€æ˜çš„ç¨‹åº¦ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ 

`opacity`å€¼ä¸ºåœ¨ 0.0 - 1.0 çš„èŒƒå›´å†…çš„æµ®ç‚¹æ•°ï¼Œè¡¨æ˜æè´¨çš„é€æ˜åº¦ã€‚å€¼ 0.0 è¡¨ç¤ºå®Œå…¨é€æ˜ï¼Œ1.0 è¡¨ç¤ºå®Œå…¨ä¸é€æ˜ã€‚ å¦‚æœæè´¨çš„ transparet å±æ€§æœªè®¾ç½®ä¸º trueï¼Œåˆ™æè´¨å°†ä¿æŒå®Œå…¨ä¸é€æ˜ï¼Œæ­¤å€¼ä»…å½±å“å…¶é¢œè‰²ã€‚ é»˜è®¤å€¼ä¸º 1.0ã€‚

`alpha`è´´å›¾æ˜¯ä¸€å¼ ç°åº¦çº¹ç†ï¼Œç”¨äºæ§åˆ¶æ•´ä¸ªè¡¨é¢çš„ä¸é€æ˜åº¦ã€‚ï¼ˆé»‘è‰²ï¼šå®Œå…¨é€æ˜ï¼›ç™½è‰²ï¼šå®Œå…¨ä¸é€æ˜ï¼‰ã€‚ é»˜è®¤å€¼ä¸ºnullã€‚

ä¸‹å›¾æ˜¯ä¸€å¼ é€æ˜åº¦è´´å›¾ï¼Œç™½è‰²çš„åœ°æ–¹ä»£è¡¨è¢«ç•™ä¸‹æ¥çš„ï¼Œè€Œé»‘è‰²çš„åœ°æ–¹ä»£è¡¨ä¼šè¢«è¿‡æ»¤æ‰çš„ã€‚

![5.png](./img/5.png)

æˆ‘ä»¬å°†ä½¿ç”¨ä¸‹å›¾æ‰€ç¤ºçš„é¢œè‰²è´´å›¾ï¼Œå†ä½¿ç”¨äº†ä¸Šè¿°çš„é€æ˜åº¦è´´å›¾åï¼Œé—¨çš„åŒºåŸŸä»¥å¤–çš„å°†å®Œå…¨è¢«è¿‡æ»¤æ‰

![6.png](./img/6.png)

### 4.4.3 ç¯å¢ƒé®æŒ¡è´´å›¾

ambient occlusion mapï¼Œè¯¥çº¹ç†çš„çº¢è‰²é€šé“ç”¨ä½œç¯å¢ƒé®æŒ¡è´´å›¾ã€‚é»˜è®¤å€¼ä¸ºnullã€‚aoMapéœ€è¦ç¬¬äºŒç»„UVã€‚

ç¯å¢ƒé®æŒ¡è´´å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![7.png](./img/7.png)

è¦ä½¿ç¯å¢ƒè´´å›¾ç”Ÿæ•ˆï¼Œé¦–å…ˆå¾—ç»™å‡ ä½•ä½“æ·»åŠ ç¬¬äºŒç»„ uv å±æ€§ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š

```tsx
geometry.setAttribute(
  "uv2",
  new THREE.BufferAttribute(geometry.attributes.uv.array, 2)
);
```

**`aoMapIntensity`** æ˜¯ç¯å¢ƒé®æŒ¡æ•ˆæœçš„å¼ºåº¦ã€‚é»˜è®¤å€¼ä¸º1ã€‚é›¶æ˜¯ä¸é®æŒ¡æ•ˆæœã€‚é€šè¿‡è°ƒèŠ‚è¯¥å€¼ï¼Œå¯ä»¥æ›´ç›´è§‚çš„çœ‹åˆ°é˜´å½±æ•ˆæœå¼ºåº¦ã€‚

![8.png](./img/8.png)

### 4.4.4 æ¸²æŸ“é¢

sideå®šä¹‰å°†è¦æ¸²æŸ“å“ªä¸€é¢ï¼šæ­£é¢ï¼ŒèƒŒé¢æˆ–ä¸¤è€…ã€‚ é»˜è®¤ä¸º THREE.FrontSideã€‚å…¶ä»–é€‰é¡¹æœ‰ THREE.BackSide å’Œ THREE.DoubleSideã€‚

è¦æ³¨æ„çš„æ˜¯ï¼ŒTHREE.DoubleSide å°½é‡ä¸è¦ä½¿ç”¨ï¼Œå› ä¸ºä¼šç»™ GPU å¸¦æ¥æ›´å¤šå¤§å‹åŠ›

è®¾ç½® THREE.DoubleSide æ•ˆæœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°é—¨çš„èƒŒé¢ä¹Ÿè¢«é™„ä¸Šäº†çº¹ç†ã€‚

![9.png](./img/9.png)

## 4.5 æ ‡å‡†æè´¨å‚æ•°

`MeshStandardMaterial` æ˜¯åŸºäºç‰©ç†æ¸²æŸ“çš„ï¼ˆphysically based rendering, PBRï¼‰ã€‚å®ƒæ”¯æŒå…‰æ•ˆï¼Œå¹¶æœ‰ä¸€ä¸ªæ›´æ‹ŸçœŸçš„ç®—æ³•ï¼Œæ”¯æŒäº†æ›´å¤šå‚æ•°å¦‚ç²—ç³™åº¦ã€é‡‘å±æ€§ã€‚

ä¹‹æ‰€ä»¥æ˜¯ Standard å› ä¸º PBR å·²ç»åœ¨å¾ˆå¤šè½¯ä»¶ã€å¼•æ“å’Œåº“é‡Œæˆä¸ºä¸€ç§æ ‡å‡†ã€‚

### 4.5.1 ç½®æ¢è´´å›¾

`displacementMap`ç½®æ¢è´´å›¾åˆåä½ç§»è´´å›¾ã€‚å®ƒä¼šå½±å“ç½‘æ ¼é¡¶ç‚¹çš„ä½ç½®ï¼Œä¸ä»…å½±å“æè´¨çš„å…‰ç…§å’Œé˜´å½±çš„å…¶ä»–è´´å›¾ä¸åŒï¼Œç§»ä½çš„é¡¶ç‚¹å¯ä»¥æŠ•å°„é˜´å½±ï¼Œé˜»æŒ¡å…¶ä»–å¯¹è±¡ï¼Œ ä»¥åŠå……å½“çœŸå®çš„å‡ ä½•ä½“ã€‚ä½ç§»çº¹ç†æ˜¯æŒ‡ï¼šç½‘æ ¼çš„æ‰€æœ‰é¡¶ç‚¹è¢«æ˜ å°„ä¸ºå›¾åƒä¸­æ¯ä¸ªåƒç´ çš„å€¼ï¼ˆç™½è‰²æ˜¯æœ€é«˜çš„ï¼‰ï¼Œå¹¶ä¸”è¢«é‡å®šä½ã€‚

è¿™é‡Œä½¿ç”¨çš„ç½®æ¢è´´å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![10.png](./img/10.png)

`displacementScale`ç½®æ¢è´´å›¾å¯¹ç½‘æ ¼çš„å½±å“ç¨‹åº¦ï¼ˆé»‘è‰²æ˜¯æ— ä½ç§»ï¼Œç™½è‰²æ˜¯æœ€å¤§ä½ç§»ï¼‰ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ä½ç§»è´´å›¾ï¼Œåˆ™ä¸ä¼šåº”ç”¨æ­¤å€¼ã€‚é»˜è®¤å€¼ä¸º1ã€‚é€šè¿‡è°ƒèŠ‚`displacementScale` çš„å€¼ï¼Œå‘ç°è¯¥å€¼è¶Šå¤§ï¼Œé—¨å‡¸èµ·çš„ç¨‹åº¦è¶Šå¤§ã€‚

![11.png](./img/11.png)

### 4.5.2 é‡‘å±åº¦è´´å›¾

`metalnessMap` æ˜¯é‡‘å±åº¦è´´å›¾ã€‚è¯¥çº¹ç†çš„è“è‰²é€šé“ç”¨äºæ”¹å˜æè´¨çš„é‡‘å±åº¦ã€‚

ä½¿ç”¨çš„é‡‘å±åº¦è´´å›¾å¦‚ä¸‹æ‰€ç¤ºï¼Œå®ƒç”¨æ¥ä½¿é—¨é”æ›´å…·æœ‰é‡‘å±è´¨æ„Ÿã€‚é€šå¸¸å¯ä¸ç²—ç³™åº¦è´´å›¾ä¸€èµ·ä½¿ç”¨ã€‚

![12.png](./img/12.png)

### 4.5.3 ç²—ç³™åº¦è´´å›¾

`roughnessMap` æ˜¯ç²—ç³™åº¦è´´å›¾ã€‚è¯¥çº¹ç†çš„ç»¿è‰²é€šé“ç”¨äºæ”¹å˜æè´¨çš„ç²—ç³™åº¦ã€‚

ä½¿ç”¨çš„ç²—ç³™åº¦è´´å›¾å¦‚ä¸‹æ‰€ç¤ºï¼Œå®ƒç”¨æ¥æ”¹å˜é—¨é”çš„ç²—ç³™åº¦ã€‚

![13.png](./img/13.png)

`roughness`æè´¨çš„ç²—ç³™ç¨‹åº¦ã€‚0.0è¡¨ç¤ºå¹³æ»‘çš„é•œé¢åå°„ï¼Œ1.0è¡¨ç¤ºå®Œå…¨æ¼«åå°„ã€‚é»˜è®¤å€¼ä¸º1.0ã€‚å¦‚æœè¿˜æä¾›roughnessMapï¼Œåˆ™ä¸¤ä¸ªå€¼ç›¸ä¹˜ã€‚é€šè¿‡æ”¹å˜è¯¥å€¼ï¼Œå‘ç°ç²—ç³™ç¨‹åº¦è¶Šæ˜æ˜¾ã€‚

### 4.5.4 æ³•çº¿è´´å›¾

`normalMap`ç”¨äºåˆ›å»ºæ³•çº¿è´´å›¾çš„çº¹ç†ã€‚RGBå€¼ä¼šå½±å“æ¯ä¸ªåƒç´ ç‰‡æ®µçš„æ›²é¢æ³•çº¿ï¼Œå¹¶æ›´æ”¹é¢œè‰²ç…§äº®çš„æ–¹å¼ã€‚æ³•çº¿è´´å›¾ä¸ä¼šæ”¹å˜æ›²é¢çš„å®é™…å½¢çŠ¶ï¼Œåªä¼šæ”¹å˜å…‰ç…§ã€‚

ä½¿ç”¨çš„æ³•çº¿è´´å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼›

![14.png](./img/14.png)

ä½¿ç”¨äº†æ³•çº¿è´´å›¾åï¼Œæ³•çº¿é—¨ç¼ä¹‹é—´æ£±è§’æ›´åŠ åˆ†æ˜ã€‚

![15.png](./img/15.png)

## 4.6 ç¯å¢ƒè´´å›¾

ç¯å¢ƒè´´å›¾ï¼Œåœ¨å‡ ä½•ä½“ä¸Šç”¨äºåå°„å‡ºå‘¨å›´ç¯å¢ƒçš„ä¸€ç§çº¹ç†è´´å›¾ã€‚

å…¶ä¸»è¦åŒ…æ‹¬ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯çƒé¢ç¯å¢ƒçº¹ç†ï¼Œå¦ä¸€ç§æ˜¯ç«‹æ–¹ä½“ç¯å¢ƒçº¹ç†æ¨¡å¼ã€‚ä¸¤ç§å®ç°æ–¹å¼åŸç†ä¸Šä¸åœ°å›¾å­¦ä¸­çš„æŠ•å½±ç›¸ä¼¼ã€‚

- çƒå½¢å…¨æ™¯æ˜¯å°†çƒå½¢çš„ç»åº¦å’Œçº¬åº¦åæ ‡ï¼Œç›´æ¥åˆ°æ°´å¹³å’Œå‚ç›´åæ ‡çš„ä¸€æ ¼ï¼Œè¿™ä¸ªç½‘æ ¼çš„é«˜åº¦å¤§çº¦å®½çš„ä¸¤å€ã€‚å› æ­¤ä»èµ¤é“åˆ°ä¸¤æï¼Œæ¨ªå‘æ‹‰ä¼¸ä¸æ–­åŠ å‰§ï¼Œå—åŒ—ä¸¤ä¸ªæç‚¹è¢«æ‹‰ä¼¸æˆäº†æ‰å¹³çš„ç½‘æ ¼åœ¨æ•´ä¸ªä¸Šéƒ¨å’Œä¸‹éƒ¨è¾¹ç¼˜ã€‚çƒå½¢å…¨æ™¯å¯ä»¥ç°å®æ•´ä¸ªæ°´å¹³å’Œç«–ç›´çš„360å…¨æ™¯ã€‚
- ç«‹æ–¹ä½“å…¨æ™¯æ˜¯å°†å…¨æ™¯å›¾åˆ†æˆäº†å‰åå·¦å³ä¸Šä¸‹å…­ä¸ªé¢ï¼Œæµè§ˆçš„æ—¶å€™å°†å…­ä¸ªé¢ç»“åˆæˆä¸€ä¸ªå¯†é—­ç©ºé—´æ¥ç°å®æ•´ä¸ªæ°´å¹³å’Œç«–ç›´çš„360å…¨æ™¯ã€‚

å®ç°åŸç†å¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡ç« 

[Webå…¨æ™¯å›¾çš„åŸç†åŠå®ç°](https://zhuanlan.zhihu.com/p/30601155)

### 4.6.1 ä½¿ç”¨ç¯å¢ƒè´´å›¾

è¿™é‡Œä½¿ç”¨CubeTextureLoaderåŠ è½½ç«‹æ–¹ä½“ç¯å¢ƒçº¹ç†ã€‚å®ƒæ˜¯çº¹ç†è´´å›¾CubeTextureçš„ä¸€ä¸ªåŠ è½½ç±»ã€‚ å†…éƒ¨ä½¿ç”¨ImageLoaderæ¥åŠ è½½æ–‡ä»¶ã€‚px/nx/py/ny/pz/nzï¼šè¯¥å…­ä¸ªé…ç½®é¡¹åˆ†åˆ«è¡¨ç¤ºç›’æ¨¡å‹å…­ä¸ªè´´é¢åœ¨åæ ‡ç³»ä¸­ä¸åŒæ–¹å‘çš„è´´å›¾åœ°å€ã€‚

```tsx
const cubeTextureLoader = new THREE.CubeTextureLoader();
const envMapTexture = cubeTextureLoader.load([
  "/textures/environmentMaps/1/px.jpg",
  "/textures/environmentMaps/1/nx.jpg",
  "/textures/environmentMaps/1/py.jpg",
  "/textures/environmentMaps/1/ny.jpg",
  "/textures/environmentMaps/1/pz.jpg",
  "/textures/environmentMaps/1/nz.jpg",
]);
// ç»™åœºæ™¯æ·»åŠ èƒŒæ™¯
scene.background = envMapTexture;
// ç»™åœºæ™¯æ‰€æœ‰çš„ç‰©ä½“æ·»åŠ é»˜è®¤çš„ç¯å¢ƒè´´å›¾
scene.environment = envMapTexture;
```

æ·»åŠ ä¸Šè¿°æ‰€ç¤ºçš„ä»£ç ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ç¯å¢ƒè´´å›¾æ•ˆæœã€‚

![16.png](./img/16.png)

### 4.6.2 HDR****ç¯å¢ƒçº¹ç†****

ä¸Šè¿°ä½¿ç”¨ç¯å¢ƒè´´å›¾çš„æ–¹å¼éœ€è¦å…­å¼ å›¾ç‰‡æ‰èƒ½ç”Ÿæˆç¯å¢ƒçº¹ç†ã€‚å¦‚æœä½¿ç”¨hdrçš„è¯ï¼Œåªéœ€è¦ä¸€å¼ å›¾ç‰‡å°±èƒ½ç”Ÿæˆç¯å¢ƒçº¹ç†ã€‚

HDRå…¨ç§°High-Dynamic Rangeï¼ˆé«˜åŠ¨æ€å…‰ç…§æ¸²æŸ“ï¼‰ï¼Œé€šè¿‡HDRï¼Œæ˜¾ç¤ºå™¨æˆ–ç›¸æœºå¯ä»¥å¾ˆå¥½çš„è¡¨ç°è¶…å‡ºå…¶äº®åº¦èŒƒå›´çš„å›¾åƒï¼Œä¹Ÿå¯ä»¥ç®€å•ç†è§£ä¸ºHDRèƒ½å¤§å¹…æé«˜ç”»é¢ç»†èŠ‚çš„æ˜æš—å¯¹æ¯”åº¦ã€‚ç›´ç™½ç‚¹è®²ï¼ŒHDRæ˜¯æŒ‡ä¸€ä¸ªå›¾åƒä¸­æœ€äº®å¤„å’Œæœ€æš—å¤„ä¹‹é—´çš„æ¯”å€¼ï¼Œèƒ½å¤Ÿè®©å›¾åƒæ˜äº®çš„åœ°æ–¹æ›´äº®ï¼Œè€Œé»‘è‰²çš„åœ°æ–¹æ›´é»‘æš—æ·±é‚ƒã€‚
è¿™é‡Œä½¿ç”¨RGBELoaderæ¥åŠ è½½hdrå›¾ç‰‡ã€‚è¿™é‡Œéœ€è¦åœ¨åŠ è½½å®Œæ¯•åç»™çº¹ç†æ˜ å°„è®¾ç½®ä¸ºTHREE.EquirectangularReflectionMappingã€‚è¿™æ ·æ‰èƒ½å°†ä¸€å¼ å›¾ç‰‡è®¾ç½®æˆ360Â°å…¨æ¯å›¾ã€‚

```tsx
const rgbeLoader = new RGBELoader();
rgbeLoader.loadAsync("/textures/hdr/002.hdr").then((texture) => {
  texture.mapping = THREE.EquirectangularReflectionMapping;
  scene.background = texture;
  scene.environment = texture;
});
```

æœ€ç»ˆçš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![17.png](./img/17.png)